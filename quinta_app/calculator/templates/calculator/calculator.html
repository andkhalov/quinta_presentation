{% extends 'calculator/base.html' %}
{% load static %}

{% block title %}–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–∞{% endblock %}

{% block extra_scripts %}
<script src="{% static 'calculator/js/calculator.js' %}?v=4"></script>
{% endblock %}

{% block content %}
<div class="page-header" style="padding: 1.5rem 0;">
    <div class="container">
        <h1 class="page-title" style="font-size: 1.75rem; margin-bottom: 0.25rem;">üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–∞</h1>
        <p class="page-subtitle" style="margin: 0; font-size: 0.9rem;">–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥</p>
    </div>
</div>

<section class="section" id="calculator-app" style="padding: 1.5rem 0;">
    <div class="container">
        <div class="calc-grid-compact">
            <!-- Left: Parameters -->
            <div class="calc-params">
                <div class="params-section">
                    <h3 class="params-title">üìä –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                    <div class="params-grid">
                        <div class="param-row">
                            <label>–õ–∏—á–Ω—ã–π PV (–õ–¢)</label>
                            <div class="param-control">
                                <input type="range" id="lt-pv-slider" min="0" max="500" value="70" step="35">
                                <span id="lt-pv" class="param-value">70</span>
                            </div>
                        </div>
                        <div class="param-row">
                            <label>–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ (–õ–ü)</label>
                            <div class="param-control">
                                <input type="range" id="invited-count-slider" min="0" max="30" value="4">
                                <span id="invited-count" class="param-value">4</span>
                            </div>
                        </div>
                        <div class="param-row">
                            <label>–ì—Ä—É–ø–ø–æ–≤–æ–π PV (T)</label>
                            <div class="param-control">
                                <input type="range" id="team-pv-slider" min="0" max="50000" value="3000" step="500">
                                <span id="team-pv" class="param-value">3 000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="params-section">
                    <h3 class="params-title">üë• –£—Ä–æ–≤–Ω–∏ –∫–æ–º–∞–Ω–¥—ã</h3>
                    <div class="levels-grid">
                        <div class="level-row">
                            <span class="level-label">1 —É—Ä <small>(5%)</small></span>
                            <input type="range" id="level1-pv-slider" min="0" max="2800" value="1000" step="100">
                            <span id="level1-pv" class="level-value">1 000</span>
                        </div>
                        <div class="level-row">
                            <span class="level-label">2 —É—Ä <small>(2.5%)</small></span>
                            <input type="range" id="level2-pv-slider" min="0" max="28000" value="3000" step="500">
                            <span id="level2-pv" class="level-value">3 000</span>
                        </div>
                        <div class="level-row">
                            <span class="level-label">3 —É—Ä <small>(2.5%)</small></span>
                            <input type="range" id="level3-pv-slider" min="0" max="100000" value="10000" step="1000">
                            <span id="level3-pv" class="level-value">10 000</span>
                        </div>
                        <div class="level-row">
                            <span class="level-label">4 —É—Ä <small>(2.5%)</small></span>
                            <input type="range" id="level4-pv-slider" min="0" max="200000" value="15000" step="1000">
                            <span id="level4-pv" class="level-value">15K</span>
                        </div>
                        <div class="level-row">
                            <span class="level-label">5 —É—Ä <small>(1.5%)</small></span>
                            <input type="range" id="level5-pv-slider" min="0" max="500000" value="25000" step="5000">
                            <span id="level5-pv" class="level-value">25K</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center: Results -->
            <div class="calc-results">
                <div class="total-box">
                    <div class="gold-badge" id="gold-badge">‚ú® –õ–∏–∫–≤–∏–¥ –∏ –¢–µ—Ä—Ä–∞ x2</div>
                    <div class="total-label">–î–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü</div>
                    <div class="total-value" id="total-income">0 ‚Ç¨</div>
                    <div class="total-sub" id="total-income-pv">0 PV</div>
                    <div class="rank-badge" id="current-rank">üå± Novus</div>
                </div>

                <div class="breakdown-compact">
                    <div class="breakdown-row">
                        <span>üéÅ –ö–µ—à–±—ç–∫</span>
                        <span id="cashback-percent" class="pct">7.5%</span>
                        <span id="cashback-value" class="val">0 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-row">
                        <span>üíº –ë–æ–Ω—É—Å –ø—Ä–æ–¥–∞–∂</span>
                        <span id="sales-bonus-percent" class="pct">3%</span>
                        <span id="sales-bonus-value" class="val">0 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-row">
                        <span>üë• –ö–æ–º–∞–Ω–¥–Ω—ã–π</span>
                        <span id="team-bonus-percent" class="pct">5-2.5%</span>
                        <span id="team-bonus-value" class="val">0 ‚Ç¨</span>
                    </div>
                    <div class="breakdown-row">
                        <span>üëë –õ–∏–¥–µ—Ä—Å–∫–∏–π</span>
                        <span id="leadership-bonus-percent" class="pct">2.5%</span>
                        <span id="leadership-bonus-value" class="val">0 ‚Ç¨</span>
                    </div>
                </div>
            </div>

            <!-- Right: Chart -->
            <div class="calc-chart">
                <canvas id="income-chart"></canvas>
            </div>
        </div>

        <!-- Quick Reference Tables -->
        <div class="quick-ref">
            <div class="ref-table">
                <h4>–ö–µ—à–±—ç–∫</h4>
                <table>
                    <tr><td>35 PV</td><td><strong>5%</strong></td></tr>
                    <tr><td>70 PV</td><td><strong>7.5%</strong></td></tr>
                    <tr><td>140 PV</td><td><strong>10%</strong></td></tr>
                    <tr class="highlight"><td>280 PV</td><td><strong>12.5%</strong></td></tr>
                </table>
            </div>
            <div class="ref-table">
                <h4>–ë–æ–Ω—É—Å –ø—Ä–æ–¥–∞–∂</h4>
                <table>
                    <tr><td>2 –õ–ü</td><td>2.5-5.5%</td></tr>
                    <tr><td>6 –õ–ü</td><td>3.5-6.5%</td></tr>
                    <tr class="highlight"><td>10+ –õ–ü</td><td><strong>4.5-7.5%</strong></td></tr>
                </table>
            </div>
            <div class="ref-table">
                <h4>–†–∞–Ω–≥–∏</h4>
                <table>
                    <tr><td>üå± Novus</td><td>35 –õ–¢</td></tr>
                    <tr><td>‚≠ê Doctus</td><td>2500 T</td></tr>
                    <tr><td>üíé Dux</td><td>11000 T</td></tr>
                    <tr class="highlight"><td>üèÜ Grandis</td><td>45000 T</td></tr>
                </table>
            </div>
        </div>
    </div>
</section>

<style>
.calc-grid-compact {
    display: grid;
    grid-template-columns: 1fr 280px 200px;
    gap: 1.5rem;
    align-items: start;
}

.calc-params {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
}

.params-section {
    margin-bottom: 1rem;
}

.params-section:last-child {
    margin-bottom: 0;
}

.params-title {
    font-size: 0.9rem;
    font-weight: 600;
    margin: 0 0 0.75rem;
    color: var(--brand-dark);
    transition: color 0.4s ease;
}

.params-grid {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.param-row {
    display: grid;
    grid-template-columns: 120px 1fr;
    align-items: center;
    gap: 0.5rem;
}

.param-row label {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-medium);
}

.param-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.param-control input[type="range"] {
    flex: 1;
    height: 6px;
}

.param-value {
    min-width: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: right;
    color: var(--green-dark);
    transition: color 0.4s ease;
}

.levels-grid {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.level-row {
    display: grid;
    grid-template-columns: 70px 1fr 65px;
    align-items: center;
    gap: 0.5rem;
}

.level-label {
    font-size: 0.75rem;
    color: var(--text-medium);
}

.level-label small {
    color: var(--green);
    font-weight: 600;
    transition: color 0.4s ease;
}

.level-row input[type="range"] {
    height: 5px;
}

.level-value {
    min-width: 65px;
    font-size: 0.8rem;
    font-weight: 600;
    text-align: right;
    color: var(--green-dark);
    transition: color 0.4s ease;
}

.calc-results {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
}

.total-box {
    background: linear-gradient(135deg, var(--green), var(--green-dark));
    color: white;
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
    margin-bottom: 1rem;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
}

.total-label {
    font-size: 0.75rem;
    opacity: 0.9;
}

.total-value {
    font-size: 2rem;
    font-weight: 800;
    line-height: 1.2;
    transition: font-size 0.4s ease, text-shadow 0.4s ease;
}

.total-sub {
    font-size: 0.8rem;
    opacity: 0.8;
}

.rank-badge {
    display: inline-block;
    background: rgba(255,255,255,0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    margin-top: 0.5rem;
    transition: background 0.4s ease, font-weight 0.4s ease;
}

/* Gold Badge */
.gold-badge {
    display: none;
    background: rgba(255, 255, 255, 0.25);
    color: #fff;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    letter-spacing: 0.5px;
    animation: goldPulse 2s ease-in-out infinite;
}

@keyframes goldPulse {
    0%, 100% { opacity: 0.85; }
    50% { opacity: 1; }
}

.breakdown-compact {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.breakdown-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0;
    border-bottom: 1px solid #f0f0f0;
    font-size: 0.8rem;
}

.breakdown-row:last-child {
    border-bottom: none;
}

.breakdown-row .pct {
    background: var(--bg-light);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.breakdown-row .val {
    font-weight: 700;
    color: var(--green);
    min-width: 50px;
    text-align: right;
    transition: color 0.4s ease;
}

.calc-chart {
    background: white;
    border-radius: 12px;
    padding: 0.75rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    min-height: 240px;
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
}

.quick-ref {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-top: 1.5rem;
}

.ref-table {
    background: white;
    border-radius: 10px;
    padding: 0.75rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

.ref-table h4 {
    font-size: 0.8rem;
    margin: 0 0 0.5rem;
    color: var(--brand-dark);
}

.ref-table table {
    width: 100%;
    font-size: 0.75rem;
}

.ref-table td {
    padding: 0.25rem 0;
}

.ref-table td:last-child {
    text-align: right;
    color: var(--green);
}

.ref-table tr.highlight {
    background: var(--green-light);
    font-weight: 600;
}

.ref-table tr.highlight td {
    padding: 0.35rem 0.25rem;
    border-radius: 4px;
    color: var(--green-dark);
}

/* ===== INCOME DISPLAY STATES ===== */

.total-box.state-grey {
    background: linear-gradient(135deg, #9e9e9e, #616161);
    box-shadow: none;
    border-color: transparent;
}

.total-box.state-green {
    background: linear-gradient(135deg, var(--green), var(--green-dark));
    box-shadow: 0 4px 16px rgba(23, 178, 42, 0.3);
    border-color: transparent;
}

/* Turquoise: bright teal gradient for 280+ PV */
.total-box.state-gold {
    background: linear-gradient(135deg, #00838F, #004D56);
    color: #fff;
    box-shadow: 0 8px 32px rgba(0, 131, 143, 0.4);
    border-color: rgba(0, 172, 193, 0.4);
    animation: glowTurquoise 3s ease-in-out infinite;
}

.total-box.state-gold .total-value {
    font-size: 2.2rem;
    font-weight: 900;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.total-box.state-gold .rank-badge {
    background: rgba(255, 255, 255, 0.2);
}

.total-box.state-blue {
    background: linear-gradient(135deg, var(--blue), var(--blue-dark));
    color: #fff;
    box-shadow: 0 8px 32px rgba(52, 89, 149, 0.4);
    border-color: rgba(122, 154, 207, 0.4);
    animation: glowBlue 3s ease-in-out infinite;
}

.total-box.state-blue .total-value {
    font-size: 2.4rem;
    font-weight: 900;
    text-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
}

.total-box.state-blue .rank-badge {
    background: rgba(255, 255, 255, 0.3);
    font-weight: 700;
}

@keyframes glowTurquoise {
    0%, 100% { box-shadow: 0 8px 32px rgba(0, 131, 143, 0.3); }
    50% { box-shadow: 0 8px 32px rgba(0, 131, 143, 0.5), 0 0 40px rgba(0, 131, 143, 0.15); }
}

@keyframes glowBlue {
    0%, 100% { box-shadow: 0 8px 32px rgba(52, 89, 149, 0.3); }
    50% { box-shadow: 0 8px 32px rgba(52, 89, 149, 0.5), 0 0 60px rgba(52, 89, 149, 0.15); }
}

/* ===== TURQUOISE MODE ‚Äî page-wide color scheme for 280+ PV ===== */

#calculator-app.gold-mode .params-title {
    color: #006B78;
}

#calculator-app.gold-mode .param-value,
#calculator-app.gold-mode .level-value {
    color: #006B78;
}

#calculator-app.gold-mode .level-label small {
    color: #00838F;
}

#calculator-app.gold-mode .breakdown-row .val {
    color: #006B78;
}

#calculator-app.gold-mode .calc-params,
#calculator-app.gold-mode .calc-results,
#calculator-app.gold-mode .calc-chart {
    border: 2px solid rgba(0, 131, 143, 0.3);
    box-shadow: 0 4px 16px rgba(0, 131, 143, 0.12);
}

#calculator-app.gold-mode .ref-table {
    border: 1px solid rgba(0, 131, 143, 0.15);
}

#calculator-app.gold-mode .ref-table tr.highlight {
    background: #B2EBF2;
}

#calculator-app.gold-mode .ref-table tr.highlight td {
    color: #322620;
}

#calculator-app.gold-mode .ref-table td:last-child {
    color: #006B78;
}

/* Turquoise mode slider tracks */
#calculator-app.gold-mode input[type="range"] {
    accent-color: #00838F;
}

#calculator-app.gold-mode input[type="range"]::-webkit-slider-runnable-track {
    background: linear-gradient(to right, #26C6DA, #00838F);
    border-radius: 3px;
}

#calculator-app.gold-mode input[type="range"]::-moz-range-track {
    background: linear-gradient(to right, #26C6DA, #00838F);
    border-radius: 3px;
}

#calculator-app.gold-mode input[type="range"]::-webkit-slider-thumb {
    background: #006B78;
    border: 2px solid #B2EBF2;
}

#calculator-app.gold-mode input[type="range"]::-moz-range-thumb {
    background: #006B78;
    border: 2px solid #B2EBF2;
}

@media (max-width: 1024px) {
    .calc-grid-compact {
        grid-template-columns: 1fr 1fr;
    }

    .calc-chart {
        grid-column: span 2;
        height: 180px;
    }
}

@media (max-width: 768px) {
    .calc-grid-compact {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .calc-params {
        padding: 0.75rem;
    }

    .params-title {
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
    }

    .params-grid {
        gap: 0.5rem;
    }

    .param-row {
        grid-template-columns: 1fr;
        gap: 0.25rem;
    }

    .param-row label {
        font-size: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .param-control {
        gap: 0.35rem;
    }

    .param-value {
        min-width: 40px;
        font-size: 0.8rem;
    }

    .levels-grid {
        gap: 0.35rem;
    }

    .level-row {
        grid-template-columns: 55px 1fr 55px;
        gap: 0.35rem;
    }

    .level-label {
        font-size: 0.7rem;
    }

    .level-value {
        min-width: 50px;
        font-size: 0.75rem;
    }

    .calc-results {
        padding: 0.75rem;
    }

    .total-box {
        padding: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .total-value {
        font-size: 1.75rem;
    }

    .total-box.state-gold .total-value {
        font-size: 1.85rem;
    }

    .total-box.state-blue .total-value {
        font-size: 1.95rem;
    }

    .total-label,
    .total-sub {
        font-size: 0.7rem;
    }

    .rank-badge {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
    }

    .gold-badge {
        font-size: 0.6rem;
        padding: 0.2rem 0.5rem;
    }

    .breakdown-compact {
        gap: 0.35rem;
    }

    .breakdown-row {
        font-size: 0.75rem;
        padding: 0.3rem 0;
        gap: 0.3rem;
    }

    .breakdown-row .pct {
        font-size: 0.65rem;
        padding: 0.1rem 0.3rem;
    }

    .breakdown-row .val {
        min-width: 40px;
        font-size: 0.75rem;
    }

    .calc-chart {
        grid-column: auto;
        padding: 0.5rem;
        min-height: 180px;
    }

    .quick-ref {
        grid-template-columns: 1fr;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .ref-table {
        padding: 0.5rem;
    }

    .ref-table h4 {
        font-size: 0.75rem;
        margin-bottom: 0.35rem;
    }

    .ref-table table {
        font-size: 0.7rem;
    }

    .ref-table td {
        padding: 0.2rem 0;
    }
}

@media (max-width: 380px) {
    .param-row label {
        font-size: 0.7rem;
    }

    .param-value {
        min-width: 35px;
        font-size: 0.75rem;
    }

    .level-row {
        grid-template-columns: 50px 1fr 50px;
    }

    .level-label {
        font-size: 0.65rem;
    }

    .level-value {
        min-width: 45px;
        font-size: 0.7rem;
    }

    .total-value {
        font-size: 1.5rem;
    }
}
</style>
{% endblock %}
